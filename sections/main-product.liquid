{% assign current_variant = product.selected_or_first_available_variant %}

<product-form data-url="{{ product.url }}" data-variants="{{ product.variants | json | escape }}">
  <div class="max-w-7xl mx-auto px-4 py-8 sm:px-6 lg:px-8">
    <div class="lg:grid lg:grid-cols-2 lg:gap-x-8 lg:items-start">
      <div class="aspect-w-1 aspect-h-1 w-full">
        <img src="{{ current_variant.featured_image | default: product.featured_image | img_url: 'large' }}" 
             alt="{{ product.featured_image.alt | escape }}" 
             class="w-full h-full object-cover rounded-lg product-image">
      </div>
      
      <div class="mt-10 px-4 sm:px-0 sm:mt-16 lg:mt-0">
        <h1 class="text-3xl font-bold tracking-tight text-gray-900">{{ product.title }}</h1>
        
        <div class="mt-3">
          <h2 class="sr-only">Product information</h2>
          <p class="text-3xl tracking-tight text-gray-900 product-price">{{ current_variant.price | money }}</p>
        </div>

        <form method="post" action="/cart/add" id="product-form" class="mt-6">
          <input type="hidden" name="id" value="{{ current_variant.id }}" data-productid="{{ product.id }}">
          
          {% for option in product.options_with_values %}
            <div class="mt-6" data-option-index="{{ forloop.index0 }}">
              <h3 class="text-sm font-medium text-gray-900">{{ option.name }}</h3>
              <div class="mt-2">
                <div class="flex flex-wrap gap-2 option-selector">
                  {% for value in option.values %}
                    {% assign option_downcase = option.name | downcase %}
                    {% assign value_downcase = value | downcase %}
                    <input type="radio" 
                           name="options[{{ option.name }}]" 
                           value="{{ value }}"
                           id="{{ option.name }}-{{ value }}"
                           class="hidden peer"
                           {% if current_variant.options[forloop.parentloop.index0] == value %}checked="checked"{% endif %}>
                    <label for="{{ option.name }}-{{ value }}"
                           class="px-4 py-2 rounded-md cursor-pointer peer-checked:bg-gray-900 peer-checked:text-white bg-gray-200 text-gray-900 option-value"
                           data-value="{{ value }}">
                      {{ value }}
                    </label>
                  {% endfor %}
                </div>
              </div>
            </div>
          {% endfor %}

          <div class="mt-8">
            <button type="submit" 
                    class="w-full bg-gray-900 text-white px-6 py-3 rounded-md flex items-center justify-center space-x-2 hover:bg-gray-800 transition-colors"
                    {% unless current_variant.available %}disabled{% endunless %}>
              <span class="loading:hidden">
                {% if current_variant.available %}Add to Cart{% else %}Sold Out{% endif %}
              </span>
              <span class="hidden loading:block">Adding...</span>
            </button>
          </div>
        </form>

        <!-- Rest of the content remains the same -->
      </div>
    </div>
  </div>
</product-form>

{{ 'product-form.js' | asset_url | script_tag }}

{% schema %}
{
  "name": "Product",
  "settings": []
}
{% endschema %}